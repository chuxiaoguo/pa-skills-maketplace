{
  "content": "\n# Better Auth Integration Guide\n\n**Always consult [better-auth.com/docs](https://better-auth.com/docs) for code examples and latest API.**\n\nBetter Auth is a TypeScript-first, framework-agnostic auth framework supporting email/password, OAuth, magic links, passkeys, and more via plugins.\n\n---\n\n## Quick Reference\n\n### Environment Variables\n- `BETTER_AUTH_SECRET` - Encryption secret (min 32 chars). Generate: `openssl rand -base64 32`\n- `BETTER_AUTH_URL` - Base URL (e.g., `https://example.com`)\n\nOnly define `baseURL`/`secret` in config if env vars are NOT set.\n\n### File Location\nCLI looks for `auth.ts` in: `./`, `./lib`, `./utils`, or under `./src`. Use `--config` for custom path.\n\n### CLI Commands\n- `npx @better-auth/cli@latest migrate` - Apply schema (built-in adapter)\n- `npx @better-auth/cli@latest generate` - Generate schema for Prisma/Drizzle\n- `npx @better-auth/cli mcp --cursor` - Add MCP to AI tools\n\n**Re-run after adding/changing plugins.**\n\n---\n\n## Core Config Options\n\n| Option | Notes |\n|--------|-------|\n| `appName` | Optional display name |\n| `baseURL` | Only if `BETTER_AUTH_URL` not set |\n| `basePath` | Default `/api/auth`. Set `/` for root. |\n| `secret` | Only if `BETTER_AUTH_SECRET` not set |\n| `database` | Required for most features. See adapters docs. |\n| `secondaryStorage` | Redis/KV for sessions & rate limits |\n| `emailAndPassword` | `{ enabled: true }` to activate |\n| `socialProviders` | `{ google: { clientId, clientSecret }, ... }` |\n| `plugins` | Array of plugins |\n| `trustedOrigins` | CSRF whitelist |\n\n---\n\n## Database\n\n**Direct connections:** Pass `pg.Pool`, `mysql2` pool, `better-sqlite3`, or `bun:sqlite` instance.\n\n**ORM adapters:** Import from `better-auth/adapters/drizzle`, `better-auth/adapters/prisma`, `better-auth/adapters/mongodb`.\n\n**Critical:** Better Auth uses adapter model names, NOT underlying table names. If Prisma model is `User` mapping to table `users`, use `modelName: \"user\"` (Prisma reference), not `\"users\"`.\n\n---\n\n## Session Management\n\n**Storage priority:**\n1. If `secondaryStorage` defined → sessions go there (not DB)\n2. Set `session.storeSessionInDatabase: true` to also persist to DB\n3. No database + `cookieCache` → fully stateless mode\n\n**Cookie cache strategies:**\n- `compact` (default) - Base64url + HMAC. Smallest.\n- `jwt` - Standard JWT. Readable but signed.\n- `jwe` - Encrypted. Maximum security.\n\n**Key options:** `session.expiresIn` (default 7 days), `session.updateAge` (refresh interval), `session.cookieCache.maxAge`, `session.cookieCache.version` (change to invalidate all sessions).\n\n---\n\n## User & Account Config\n\n**User:** `user.modelName`, `user.fields` (column mapping), `user.additionalFields`, `user.changeEmail.enabled` (disabled by default), `user.deleteUser.enabled` (disabled by default).\n\n**Account:** `account.modelName`, `account.accountLinking.enabled`, `account.storeAccountCookie` (for stateless OAuth).\n\n**Required for registration:** `email` and `name` fields.\n\n---\n\n## Email Flows\n\n- `emailVerification.sendVerificationEmail` - Must be defined for verification to work\n- `emailVerification.sendOnSignUp` / `sendOnSignIn` - Auto-send triggers\n- `emailAndPassword.sendResetPassword` - Password reset email handler\n\n---\n\n## Security\n\n**In `advanced`:**\n- `useSecureCookies` - Force HTTPS cookies\n- `disableCSRFCheck` - ⚠️ Security risk\n- `disableOriginCheck` - ⚠️ Security risk  \n- `crossSubDomainCookies.enabled` - Share cookies across subdomains\n- `ipAddress.ipAddressHeaders` - Custom IP headers for proxies\n- `database.generateId` - Custom ID generation or `\"serial\"`/`\"uuid\"`/`false`\n\n**Rate limiting:** `rateLimit.enabled`, `rateLimit.window`, `rateLimit.max`, `rateLimit.storage` (\"memory\" | \"database\" | \"secondary-storage\").\n\n---\n\n## Hooks\n\n**Endpoint hooks:** `hooks.before` / `hooks.after` - Array of `{ matcher, handler }`. Use `createAuthMiddleware`. Access `ctx.path`, `ctx.context.returned` (after), `ctx.context.session`.\n\n**Database hooks:** `databaseHooks.user.create.before/after`, same for `session`, `account`. Useful for adding default values or post-creation actions.\n\n**Hook context (`ctx.context`):** `session`, `secret`, `authCookies`, `password.hash()`/`verify()`, `adapter`, `internalAdapter`, `generateId()`, `tables`, `baseURL`.\n\n---\n\n## Plugins\n\n**Import from dedicated paths for tree-shaking:**\n```\nimport { twoFactor } from \"better-auth/plugins/two-factor\"\n```\nNOT `from \"better-auth/plugins\"`.\n\n**Popular plugins:** `twoFactor`, `organization`, `passkey`, `magicLink`, `emailOtp`, `username`, `phoneNumber`, `admin`, `apiKey`, `bearer`, `jwt`, `multiSession`, `sso`, `oauthProvider`, `oidcProvider`, `openAPI`, `genericOAuth`.\n\nClient plugins go in `createAuthClient({ plugins: [...] })`.\n\n---\n\n## Client\n\nImport from: `better-auth/client` (vanilla), `better-auth/react`, `better-auth/vue`, `better-auth/svelte`, `better-auth/solid`.\n\nKey methods: `signUp.email()`, `signIn.email()`, `signIn.social()`, `signOut()`, `useSession()`, `getSession()`, `revokeSession()`, `revokeSessions()`.\n\n---\n\n## Type Safety\n\nInfer types: `typeof auth.$Infer.Session`, `typeof auth.$Infer.Session.user`.\n\nFor separate client/server projects: `createAuthClient<typeof auth>()`.\n\n---\n\n## Common Gotchas\n\n1. **Model vs table name** - Config uses ORM model name, not DB table name\n2. **Plugin schema** - Re-run CLI after adding plugins\n3. **Secondary storage** - Sessions go there by default, not DB\n4. **Cookie cache** - Custom session fields NOT cached, always re-fetched\n5. **Stateless mode** - No DB = session in cookie only, logout on cache expiry\n6. **Change email flow** - Sends to current email first, then new email\n\n---\n\n## Resources\n\n- [Docs](https://better-auth.com/docs)\n- [Options Reference](https://better-auth.com/docs/reference/options)\n- [LLMs.txt](https://better-auth.com/llms.txt)\n- [GitHub](https://github.com/better-auth/better-auth)\n- [Init Options Source](https://github.com/better-auth/better-auth/blob/main/packages/core/src/types/init-options.ts)",
  "files": [
    {
      "name": "SKILL.md",
      "path": "better-auth-best-practices/SKILL.md",
      "type": "markdown",
      "relativePath": "SKILL.md"
    }
  ]
}